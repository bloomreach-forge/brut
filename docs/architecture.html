<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 at $dateFormat.format( $currentDate ) 
 | Rendered using Bloomreach Forge Maven Skin 3.2.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="" lang="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                      <meta http-equiv="Content-Language" content="" />
      <title>BRUT Architecture â€“ B.R.U.T: BloomReach Unit Testing for brXM Delivery Tier</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.2.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.2.1.min.js"></script>

            <style>.github-fork-ribbon:before { background-color: green; }</style>
</head>
<body class="topBarDisabled">
              <a target="_blank" class="github-fork-ribbon right" href="https://github.com/bloomreach-forge/brut"
     data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="Bloomreach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">                    <h1>        Bloomreach Unit Testing Library
        </h1>            </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://xmdocumentation.bloomreach.com">xmdocumentation.bloomreach.com</a>
      <a href="https://github.com/bloomreach-forge">github.com/bloomreach-forge</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: $dateValue  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Getting Started</li>
              <li>  <a href="index.html" title="Home">  <span class="none"></span>  Home</a>  </li>
        <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li>  <a href="getting-started.html" title="Quick Start">  <span class="none"></span>  Quick Start</a>  </li>
                  <li class="nav-header">Testing Guides</li>
              <li>  <a href="testing/jaxrs-testing.html" title="JAX-RS Testing">  <span class="none"></span>  JAX-RS Testing</a>  </li>
        <li>  <a href="testing/pagemodel-testing.html" title="Page Model Testing">  <span class="none"></span>  Page Model Testing</a>  </li>
        <li>  <a href="testing/component-testing.html" title="Component Testing">  <span class="none"></span>  Component Testing</a>  </li>
        <li>  <a href="testing/stubbing-data.html" title="Test Data (YAML)">  <span class="none"></span>  Test Data (YAML)</a>  </li>
                  <li class="nav-header">Patterns</li>
              <li>  <a href="patterns/authentication.html" title="Authentication">  <span class="none"></span>  Authentication</a>  </li>
        <li>  <a href="patterns/common-patterns.html" title="Common Patterns">  <span class="none"></span>  Common Patterns</a>  </li>
                  <li class="nav-header">Reference</li>
              <li>  <a href="quick-reference.html" title="Quick Reference">  <span class="none"></span>  Quick Reference</a>  </li>
        <li>  <a href="config-service-repository.html" title="ConfigService Repository">  <span class="none"></span>  ConfigService Repository</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Architecture</a>
  </li>
        <li>  <a href="troubleshooting.html" title="Troubleshooting">  <span class="none"></span>  Troubleshooting</a>  </li>
        <li>  <a href="legacy-api.html" title="Legacy API">  <span class="none"></span>  Legacy API</a>  </li>
        <li>  <a href="apidocs/index.html" title="JavaDocs">  <span class="none"></span>  JavaDocs</a>  </li>
                  <li class="nav-header">Project</li>
              <li>  <a href="demoproject.html" title="Demo Project">  <span class="none"></span>  Demo Project</a>  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
          <a href="http://maven.apache.org/" title="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" class="poweredBy">  <img class="builtBy" alt="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" src="./images/logos/maven-feather.png" />  </a>
        </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  

    <section><a id="Overview"></a>
<h1>Overview</h1>
      
<p>BRUT boots an in-memory brXM delivery tier stack for tests. It builds a repository, loads HCM
         configuration and content, initializes the HST model, then executes the same pipelines used in
         production (component rendering, JAX-RS, Page Model API).</p>
    </section>

    <section><a id="Module_Overview"></a>
<h1>Module Overview</h1>
      
<table class="table table-striped">
        
<tr class="a">
<th>Module</th>
<th>Purpose</th></tr>
        
<tr class="b">
          
<td><strong>brut-common</strong></td>
          
<td>In-memory repository, YAML import, JUnit 5 extensions, auto-detection utilities</td>
        </tr>
        
<tr class="a">
          
<td><strong>brut-resources</strong></td>
          
<td>HST container startup, HCM module loading, request pipelines, PageModel API</td>
        </tr>
        
<tr class="b">
          
<td><strong>brut-components</strong></td>
          
<td>Component test utilities, HST request/response mocks</td>
        </tr>
      </table>
    </section>

    <section><a id="brut-common"></a>
<h1>brut-common</h1>
      
<ul>
        
<li>In-memory repository and YAML import utilities</li>
        
<li>Repository configuration from <code>repository.xml</code> on classpath</li>
        
<li>Test authentication via in-memory login module</li>
      </ul>

      <section><a id="Key_Classes"></a>
<h2>Key Classes</h2>
        
<table class="table table-striped">
          
<tr class="a">
<th>Class</th>
<th>Purpose</th></tr>
          
<tr class="b">
<td><code>BrutTestConfigurationException</code></td>
<td>Unified error handling with factory methods</td></tr>
          
<tr class="a">
<td><code>TestConfigurationLogger</code></td>
<td>Consistent configuration logging</td></tr>
          
<tr class="b">
<td><code>TestInstanceInjector</code></td>
<td>JUnit 5 field injection</td></tr>
          
<tr class="a">
<td><code>AbstractBrutRepository</code></td>
<td>Shared CND/namespace handling</td></tr>
        </table>
      </section>
    </section>

    <section><a id="brut-resources"></a>
<h1>brut-resources</h1>
      
<ul>
        
<li>Loads HCM modules (config + content) via Config Service APIs</li>
        
<li>Initializes the HST container and request pipelines</li>
      </ul>

      <section><a id="Bootstrap_Components"></a>
<h2>Bootstrap Components</h2>
        
<table class="table table-striped">
          
<tr class="a">
<th>Class</th>
<th>Purpose</th></tr>
          
<tr class="b">
<td><code>ConfigServiceBootstrapStrategy</code></td>
<td>Orchestrates HCM-based bootstrap</td></tr>
          
<tr class="a">
<td><code>RuntimeTypeStubber</code></td>
<td>Stubs missing namespaces/node types</td></tr>
          
<tr class="b">
<td><code>JcrNodeSynchronizer</code></td>
<td>Syncs JCR nodes between trees</td></tr>
          
<tr class="a">
<td><code>ConfigServiceReflectionBridge</code></td>
<td>Reflection access to ConfigService</td></tr>
        </table>
      </section>

      <section><a id="Request_Utilities"></a>
<h2>Request Utilities</h2>
        
<table class="table table-striped">
          
<tr class="a">
<th>Class</th>
<th>Purpose</th></tr>
          
<tr class="b">
<td><code>MockHstRequest</code></td>
<td>Extended mock with HTTP session support</td></tr>
          
<tr class="a">
<td><code>RequestBuilder</code></td>
<td>Fluent API for request setup</td></tr>
          
<tr class="b">
<td><code>PageModelResponse</code></td>
<td>Navigation utility for Page Model API responses</td></tr>
        </table>
      </section>
    </section>

    <section><a id="brut-components"></a>
<h1>brut-components</h1>
      
<p>Component-test utilities and mocks for HST components:</p>
      
<ul>
        
<li><code>@BrxmComponentTest</code> annotation</li>
        
<li><code>DynamicComponentTest</code> test harness</li>
        
<li>Request/response mocking</li>
        
<li>Component parameter injection</li>
      </ul>
    </section>

    <section><a id="Bootstrap_Flow"></a>
<h1>Bootstrap Flow</h1>
      
<ol style="list-style-type: decimal;">
        
<li>Register CND node types from configured patterns</li>
        
<li>Load HCM modules from descriptors or explicit module paths</li>
        
<li>Build the configuration model and apply namespaces/node types</li>
        
<li>Import content definitions into the repository</li>
        
<li>Build the HST model from the repository</li>
      </ol>
    </section>

    <section><a id="Request_Flow_.28Page_Model_API.29"></a>
<h1>Request Flow (Page Model API)</h1>
      
<div class="brush: plain">
        
<pre><code>
Test -&gt; DynamicPageModelTest -&gt; HST Container -&gt; HST Model/Cache
  |           |                    |                |
  |           |                    |                +--&gt; Resolve sitemap item
  |           |                    |                +--&gt; Resolve channel (preview/live)
  |           |                    |                +--&gt; Resolve component tree
  |           |                    |                         |
  |           |                    |                         +--&gt; Resolve container refs
  |           |                    |                              (hst:workspace/hst:containers)
  |           |                    |                         +--&gt; Build container items
  |           |                    |
  |           |                    +--&gt; Build Page Model JSON
  |           |
  +--&gt; Response JSON (root + page map with $ref links)
        </code></pre>
      </div>
    </section>

    <section><a id="Request_Flow_.28Component.2FJAX-RS.29"></a>
<h1>Request Flow (Component/JAX-RS)</h1>
      
<div class="brush: plain">
        
<pre><code>
Test -&gt; DynamicComponentTest/DynamicJaxrsTest -&gt; HST Container -&gt; HST Model/Cache
  |                |                               |                |
  |                |                               |                +--&gt; Resolve mount + sitemap item
  |                |                               |                +--&gt; Resolve component tree
  |                |                               |                +--&gt; Build request context
  |                |                               |
  |                |                               +--&gt; Execute pipeline (component/jaxrs)
  |                |
  +--&gt; Response (rendered output or JAX-RS payload)
        </code></pre>
      </div>
    </section>

    <section><a id="HST_Configuration_Resolution"></a>
<h1>HST Configuration Resolution</h1>
      <section><a id="Composite_Configuration"></a>
<h2>Composite Configuration</h2>
        
<p>HST loads a composite configuration: base config overlaid by workspace nodes. This is how
           workspace containers, sitemenus, and channel info become visible to the model.</p>
      </section>

      <section><a id="Container_References"></a>
<h2>Container References</h2>
        
<ul>
          
<li><code>hst:containercomponentreference</code> resolves against <code>hst:workspace/hst:containers</code></li>
          
<li>Container items are <code>hst:containeritemcomponent</code> children</li>
          
<li>If the referenced workspace path is missing, the reference is ignored</li>
        </ul>
      </section>

      <section><a id="Sitemenus_and_Channel_Info"></a>
<h2>Sitemenus and Channel Info</h2>
        
<ul>
          
<li>Sitemenus can live under both <code>hst:sitemenus</code> and <code>hst:workspace/hst:sitemenus</code></li>
          
<li>Channel info is resolved from the mount</li>
          
<li>Preview mounts use the preview configuration and its workspace overlays</li>
        </ul>
      </section>
    </section>

    <section><a id="Caching_and_Refresh"></a>
<h1>Caching and Refresh</h1>
      
<p>HST model caches are built during initialization. If configuration/content is imported after
         the model is built, caches must be invalidated or the model rebuilt for changes to take effect.</p>
    </section>

    <section><a id="Customization_Points"></a>
<h1>Customization Points</h1>
      
<table class="table table-striped">
        
<tr class="a">
<th>What</th>
<th>How</th></tr>
        
<tr class="b">
          
<td>Repository behavior/auth</td>
          
<td>Custom <code>repository.xml</code> on classpath</td>
        </tr>
        
<tr class="a">
          
<td>Module loading</td>
          
<td>Explicit module descriptors in tests</td>
        </tr>
        
<tr class="b">
          
<td>CND/YAML patterns</td>
          
<td>Spring configuration or annotation parameters</td>
        </tr>
      </table>
    </section>

  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2007&#x2013;${currentYear}
              <a href="https://www.bloomreach.com">Bloomreach</a>.
          
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

